!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n,e=i();for(n in e)("object"==typeof exports?exports:t)[n]=e[n]}}(self,function(){return(()=>{var n=[,(t,i,n)=>{"use strict";t.exports=e,t.exports.default=e;var s=n(2);function e(t,i){if(!(this instanceof e))return new e(t,i);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&this._initFormat(i),this.clear()}function _(t,i){p(t,0,t.children.length,i,t)}function p(t,i,n,e,a){(a=a||f(null)).minX=1/0,a.minY=1/0,a.maxX=-1/0,a.maxY=-1/0;for(var o,r=i;r<n;r++)o=t.children[r],m(a,t.leaf?e(o):o);return a}function m(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function o(t,i){return t.minX-i.minX}function r(t,i){return t.minY-i.minY}function d(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function l(t){return t.maxX-t.minX+(t.maxY-t.minY)}function u(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function c(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function f(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function x(t,i,n,e,a){for(var o,r=[i,n];r.length;)(n=r.pop())-(i=r.pop())<=e||(o=i+Math.ceil((n-i)/e/2)*e,s(t,o,i,n,a),r.push(i,o,o,n))}e.prototype={all:function(){return this._all(this.data,[])},search:function(t){var i=this.data,n=[],e=this.toBBox;if(!c(t,i))return n;for(var a,o,r,s,h=[];i;){for(a=0,o=i.children.length;a<o;a++)r=i.children[a],c(t,s=i.leaf?e(r):r)&&(i.leaf?n.push(r):u(t,s)?this._all(r,n):h.push(r));i=h.pop()}return n},collides:function(t){var i=this.data,n=this.toBBox;if(!c(t,i))return!1;for(var e,a,o,r,s=[];i;){for(e=0,a=i.children.length;e<a;e++)if(o=i.children[e],c(t,r=i.leaf?n(o):o)){if(i.leaf||u(t,r))return!0;s.push(o)}i=s.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0,n=t.length;i<n;i++)this.insert(t[i]);return this}var e,a=this._build(t.slice(),0,t.length-1,0);return this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(e=this.data,this.data=a,a=e),this._insert(a,this.data.height-a.height-1,!0)):this.data=a,this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=f([]),this},remove:function(t,i){if(!t)return this;for(var n,e,a,o,r=this.data,s=this.toBBox(t),h=[],c=[];r||h.length;){if(r||(r=h.pop(),e=h[h.length-1],n=c.pop(),o=!0),r.leaf&&-1!==(a=function(t,i,n){if(!n)return i.indexOf(t);for(var e=0;e<i.length;e++)if(n(t,i[e]))return e;return-1}(t,r.children,i)))return r.children.splice(a,1),h.push(r),this._condense(h),this;o||r.leaf||!u(r,s)?e?(n++,r=e.children[n],o=!1):r=null:(h.push(r),c.push(n),r=(e=r).children[n=0])}return this},toBBox:function(t){return t},compareMinX:o,compareMinY:r,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},_build:function(t,i,n,e){var a,o=n-i+1,r=this._maxEntries;if(o<=r)return _(a=f(t.slice(i,n+1)),this.toBBox),a;e||(e=Math.ceil(Math.log(o)/Math.log(r)),r=Math.ceil(o/Math.pow(r,e-1))),(a=f([])).leaf=!1,a.height=e;var s,h,c,m,l=Math.ceil(o/r),u=l*Math.ceil(Math.sqrt(r));for(x(t,i,n,u,this.compareMinX),s=i;s<=n;s+=u)for(x(t,s,c=Math.min(s+u-1,n),l,this.compareMinY),h=s;h<=c;h+=l)m=Math.min(h+l-1,c),a.children.push(this._build(t,h,m,e-1));return _(a,this.toBBox),a},_chooseSubtree:function(t,i,n,e){for(var a,o,r,s,h,c,m,l,u;;){if(e.push(i),i.leaf||e.length-1===n)break;for(c=m=1/0,a=0,o=i.children.length;a<o;a++)h=d(r=i.children[a]),l=t,u=r,(l=(Math.max(u.maxX,l.maxX)-Math.min(u.minX,l.minX))*(Math.max(u.maxY,l.maxY)-Math.min(u.minY,l.minY))-h)<m?(m=l,c=h<c?h:c,s=r):l===m&&h<c&&(c=h,s=r);i=s||i.children[0]}return i},_insert:function(t,i,n){var e=this.toBBox,n=n?t:e(t),a=[],e=this._chooseSubtree(n,this.data,i,a);for(e.children.push(t),m(e,n);0<=i&&a[i].children.length>this._maxEntries;)this._split(a,i),i--;this._adjustParentBBoxes(n,a,i)},_split:function(t,i){var n=t[i],e=n.children.length,a=this._minEntries;this._chooseSplitAxis(n,a,e);e=this._chooseSplitIndex(n,a,e),e=f(n.children.splice(e,n.children.length-e));e.height=n.height,e.leaf=n.leaf,_(n,this.toBBox),_(e,this.toBBox),i?t[i-1].children.push(e):this._splitRoot(n,e)},_splitRoot:function(t,i){this.data=f([t,i]),this.data.height=t.height+1,this.data.leaf=!1,_(this.data,this.toBBox)},_chooseSplitIndex:function(t,i,n){for(var e,a,o,r,s,h,c,m,l,u=o=1/0,_=i;_<=n-i;_++)e=p(t,0,_,this.toBBox),a=p(t,_,n,this.toBBox),s=e,h=a,l=m=c=void 0,c=Math.max(s.minX,h.minX),m=Math.max(s.minY,h.minY),l=Math.min(s.maxX,h.maxX),h=Math.min(s.maxY,h.maxY),m=Math.max(0,l-c)*Math.max(0,h-m),a=d(e)+d(a),m<u?(u=m,r=_,o=a<o?a:o):m===u&&a<o&&(o=a,r=_);return r},_chooseSplitAxis:function(t,i,n){var e=t.leaf?this.compareMinX:o,a=t.leaf?this.compareMinY:r;this._allDistMargin(t,i,n,e)<this._allDistMargin(t,i,n,a)&&t.children.sort(e)},_allDistMargin:function(t,i,n,e){t.children.sort(e);for(var a,o=this.toBBox,r=p(t,0,i,o),s=p(t,n-i,n,o),h=l(r)+l(s),c=i;c<n-i;c++)a=t.children[c],m(r,t.leaf?o(a):a),h+=l(r);for(c=n-i-1;i<=c;c--)a=t.children[c],m(s,t.leaf?o(a):a),h+=l(s);return h},_adjustParentBBoxes:function(t,i,n){for(var e=n;0<=e;e--)m(i[e],t)},_condense:function(t){for(var i,n=t.length-1;0<=n;n--)0===t[n].children.length?0<n?(i=t[n-1].children).splice(i.indexOf(t[n]),1):this.clear():_(t[n],this.toBBox)},_initFormat:function(t){var i=["return a"," - b",";"];this.compareMinX=new Function("a","b",i.join(t[0])),this.compareMinY=new Function("a","b",i.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}}},function(t){t.exports=function(){"use strict";function t(t,i,n,e,a){d(t,i,n||0,e||t.length-1,a||o)}function d(t,i,n,e,a){while(e>n){if(e-n>600){var o=e-n+1;var r=i-n+1;var s=Math.log(o);var h=.5*Math.exp(2*s/3);var c=.5*Math.sqrt(s*h*(o-h)/o)*(r-o/2<0?-1:1);var m=Math.max(n,Math.floor(i-r*h/o+c));var l=Math.min(e,Math.floor(i+(o-r)*h/o+c));d(t,i,m,l,a)}var u=t[i];var _=n;var p=e;f(t,n,i);if(a(t[e],u)>0)f(t,n,e);while(_<p){f(t,_,p);_++;p--;while(a(t[_],u)<0)_++;while(a(t[p],u)>0)p--}if(a(t[n],u)===0)f(t,n,p);else{p++;f(t,p,e)}if(p<=i)n=p+1;if(i<=p)e=p-1}}function f(t,i,n){var e=t[i];t[i]=t[n];t[n]=e}function o(t,i){return t<i?-1:t>i?1:0}return t}()}],e={};function a(t){var i=e[t];if(void 0!==i)return i.exports;i=e[t]={exports:{}};return n[t].call(i.exports,i,i.exports,a),i.exports}a.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return a.d(i,{a:i}),i},a.d=(t,i)=>{for(var n in i)a.o(i,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},a.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{"use strict";a.r(o),a.d(o,{CanvasMarkerLayer:()=>n,canvasMarkerLayer:()=>e});var t=a(1),i=a.n(t),n=L.CanvasMarkerLayer=L.Layer.extend({options:{zIndex:null,collisionFlg:!1,moveReset:!1,opacity:1},initialize:function(t){L.setOptions(this,t),this._onClickListeners=[],this._onHoverListeners=[],this._onMouseDownListeners=[],this._onMouseUpListeners=[],this._markers=new(i()),this._markers.dirty=0,this._markers.total=0,this._containMarkers=new(i()),this._showMarkers=new(i()),this._showMarkerBounds=new(i())},setOptions:function(t){return L.setOptions(this,t),this.redraw()},redraw:function(){return this._redraw(!0)},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._reset,click:this._executeListeners,mousemove:this._executeListeners,mousedown:this._executeListeners,mouseup:this._executeListeners};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),this.options.moveReset&&(t.move=this._reset),t},addLayer:function(t,i=!0){if("markerPane"==t.options.pane&&t.options.icon){t._map=this._map;var n=t.getLatLng();L.Util.stamp(t),this._markers.insert({minX:n.lng,minY:n.lat,maxX:n.lng,maxY:n.lat,data:t}),this._markers.dirty++,this._markers.total++;n=this._map.getBounds().contains(n);return 1==i&&n&&this._redraw(!0),this}console.error("Layer isn't a marker")},addLayers:function(t,i=!0){return t.forEach(t=>{this.addLayer(t,!1)}),i&&this._redraw(!0),this},removeLayer:function(t,i=!0){var n=this,e=(t=t.minX?t.data:t).getLatLng(),a=n._map.getBounds().contains(e),t={minX:e.lng,minY:e.lat,maxX:e.lng,maxY:e.lat,data:t};return n._markers.remove(t,function(t,i){return t.data._leaflet_id===i.data._leaflet_id}),n._markers.total--,n._markers.dirty++,!0===a&&!0===i&&n._redraw(!0),this},clearLayers:function(){this._markers=new(i()),this._markers.dirty=0,this._markers.total=0,this._containMarkers=new(i()),this._showMarkers=new(i()),this._showMarkerBounds=new(i()),this._redraw(!0)},onAdd:function(t){this._map=t,this._container||this._initCanvas(),(this.options.pane?this.getPane():t._panes.overlayPane).appendChild(this._container),this._reset()},onRemove:function(t){(this.options.pane?this.getPane():t.getPanes().overlayPane).removeChild(this._container)},_drawMarker:function(t,i){var n=this;this._imageLookup||(this._imageLookup={}),i=i||n._map.latLngToContainerPoint(t.getLatLng());var e=t.options.icon.options,a=i.x-e.iconAnchor[0],o=a+e.iconSize[0],r=i.y-e.iconAnchor[1],s=r+e.iconSize[1],e={minX:a,minY:r,maxX:o,maxY:s};if(1==this.options.collisionFlg){if(this._showMarkerBounds.collides(e))return;this._showMarkerBounds.insert(e);var h=t.getLatLng();this._showMarkers.insert({minX:a,minY:r,maxX:o,maxY:s,lng:h.lng,lat:h.lat,data:t})}var c=t.options.icon.options.iconUrl;t.canvas_img?n._drawImage(t,i):n._imageLookup[c]?(t.canvas_img=n._imageLookup[c][0],!1===n._imageLookup[c][1]?n._imageLookup[c][2].push([t,i]):n._drawImage(t,i)):((h=new Image).src=c,t.canvas_img=h,n._imageLookup[c]=[h,!1,[[t,i]]],h.onload=function(){n._imageLookup[c][1]=!0,n._imageLookup[c][2].forEach(function(t){n._drawImage(t[0],t[1])})})},_drawImage:function(t,i){var n=t.options.icon.options;this._ctx.save(),this._ctx.globalAlpha=this.options.opacity,this._ctx.translate(i.x,i.y),this._ctx.rotate(n.rotate),this._ctx.drawImage(t.canvas_img,-n.iconAnchor[0],-n.iconAnchor[1],n.iconSize[0],n.iconSize[1]),this._ctx.restore()},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._container,t);t=this._map.getSize();this._container.width=t.x,this._container.height=t.y,this._update()},_redraw:function(t){this._showMarkerBounds=new(i()),this._showMarkers=new(i());var a=this;if(t&&this._ctx.clearRect(0,0,this._container.width,this._container.height),this._map&&this._markers){var o=[];.1<=a._markers.dirty/a._markers.total&&(a._markers.all().forEach(function(t){o.push(t)}),a._markers.clear(),a._markers.load(o),a._markers.dirty=0,o=[]);t=a._map.getBounds(),t={minX:t.getWest(),minY:t.getSouth(),maxX:t.getEast(),maxY:t.getNorth()};return a._markers.search(t).forEach(function(t){var i=a._map.latLngToContainerPoint(t.data.getLatLng()),n=t.data.options.icon.options.iconSize,e=n[0]/2,n=n[1]/2,i={minX:i.x-e,minY:i.y-n,maxX:i.x+e,maxY:i.y+n,data:t.data,pointPos:i};o.push(i)}),o.sort((t,i)=>{return(-(t.data.options.zIndex||1)+(i.data.options.zIndex||1))*(this.options.collisionFlg?1:-1)}).forEach(t=>{var i=t.pointPos;a._drawMarker(t.data,i)}),this._containMarkers.clear(),this._containMarkers.load(o),1!=this.options.collisionFlg&&(this._showMarkers=this._containMarkers),this}},_initCanvas:function(){this._container=L.DomUtil.create("canvas","leaflet-canvas-icon-layer leaflet-layer"),this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex);var t=this._map.getSize();this._container.width=t.x,this._container.height=t.y,this._ctx=this._container.getContext("2d");t=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._container,"leaflet-zoom-"+(t?"animated":"hide"))},addOnClickListener:function(t){this._onClickListeners.push(t)},addOnHoverListener:function(t){this._onHoverListeners.push(t)},addOnMouseDownListener:function(t){this._onMouseDownListeners.push(t)},addOnMouseUpListener:function(t){this._onMouseUpListeners.push(t)},_executeListeners:function(i){var t,n,e,a;this._showMarkers&&(n=i.containerPoint.x,e=i.containerPoint.y,(t=this)._openToolTip&&(t._openToolTip.closeTooltip(),delete t._openToolTip),(a=this._showMarkers.search({minX:n,minY:e,maxX:n,maxY:e}))&&0<a.length?(t._map._container.style.cursor="pointer","click"===i.type&&(a[0].data.getPopup()&&a[0].data.openPopup(),t._onClickListeners.forEach(function(t){t(i,a)})),"mousemove"===i.type&&(a[0].data.getTooltip()&&(t._openToolTip=a[0].data,a[0].data.openTooltip()),t._onHoverListeners.forEach(function(t){t(i,a)})),"mousedown"===i.type&&t._onMouseDownListeners.forEach(function(t){t(i,a)}),"mouseup"===i.type&&t._onMouseUpListeners.forEach(function(t){t(i,a)})):t._map._container.style.cursor="")},_onAnimZoom(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,i){var n=this._map.getZoomScale(i,this._zoom),e=L.DomUtil.getPosition(this._container),a=this._map.getSize().multiplyBy(.5),o=this._map.project(this._center,i),o=this._map.project(t,i).subtract(o),o=a.multiplyBy(-n).add(e).add(a).subtract(o);L.Browser.any3d?L.DomUtil.setTransform(this._container,o,n):L.DomUtil.setPosition(this._container,o)},_update:function(){var t=this._map.getSize(),i=this._map.containerPointToLayerPoint(t.multiplyBy(-0)).round();this._bounds=new L.Bounds(i,i.add(t.multiplyBy(1)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom(),this._redraw()},setOpacity(t){return this.options.opacity=t,this._redraw(!0)}}),e=L.canvasMarkerLayer=function(t){return new L.CanvasMarkerLayer(t)}})(),o})()});